---
title: "Session 6 : Comparing three or more scores using ANOVA test"
author: "Moonbin Jo"
date: ''
output:
  html_document:
    theme: united
    css: style.css
    highlight: tango
mainfont: SourceSansPro
header-includes:
- \usepackage[default]{sourcesanspro}
- \usepackage[T1]{fontenc}
---

```{r setup-TD5, include=FALSE, }
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

#  {.tabset .tabset-fade .tabset-pills}

## Objectives of this session

## Exercises

```{r, include = FALSE}
library(tidyverse)
load("data_final.RData")
```

### Comparing the scores of more than three groups (Analysis of Variance)

In the earlier sessions, we compared the mean value of one sample to another value, or compared the mean values of two samples with each other. We also looked at a more complicated model to compare the mean values of two samples.

However, there are a total of ten habits, and if we want to compare them by only pairing them up, it will take a long time and also be complicated to understand the results. In this session we will find out how to compare three or more mean values by using the ANOVA test.

-   There is a statistical reason why we don't pair the data and use t-tests to see if there is a significant difference between means. This is called the multiple testing problem, and you can find additional information about this [here](https://www.stat.berkeley.edu/~mgoldman/Section0402.pdf).

In this section, we will expand our look into the effect of habit type on the score from only two habits, to all ten. Eventually what we want to see with this data is how the type of habit influences the score of constraint. However, in a statistical point of view, this question has to be divided into two steps. Before asking **HOW** this variable effects the score, we have to first investigate the variable effects the score or not.

In a more practical manner, the question we are trying to answer is "Does habit type influence the score or not?". If the type of habit did not influence the score of constraint, then **the mean values would be the same** between habits. However, if the habit type did influence the score of constraint, **the mean of scores will be different**. This is what we are trying to find out with the ANOVA test.

The `lm` function is used to fit linear models with the formula of `Score ~ Habit`. These results will be saved as `res1`. In order to understand the results of the `lm` function (`res1`), the function `anova` will be used.

```{r lm 1}
res1 <- lm(Score ~ Habit, data_long_score)
anova(res1)
```

Through the `anova` function, we have produced a "Analysis of Variance Table". What does this analysis of variance table show us?

From these results we can see that `Habit` variable has a significant effect on the score, as the p-value is smaller than 0.05. Meaning that the type of habit influences the score significantly.

### Understanding which groups are different from which (Post-hoc test)

Now that we have determined that there is a significant difference between the mean values of score, a post-hoc test can be used to identify which means are different. There are several types of post-hoc tests, and different ones are used for different situations.

-   More information on the types of post-hoc tests there are and when to use them can be found [here](https://www.statology.org/tukey-vs-bonferroni-vs-scheffe/).

As the sample size for each group are equal (as 167 participants have given 10 scores) and we want to see the differences between all of the means, we will use the Tukey HSD post-hoc test. Before performing the Tukey HSD test, we have to fit the same one-way ANOVA model `Score ~ Habit`, but with a different function. Unlike the earlier ANOVA tests, we use the function `aov` and `summary` to get the results.

```{r}
res.aov1 <- aov(Score ~ Habit, data_long_score) # fit the one-way ANOVA model
res.aov1 %>% summary() # get the results of the ANOVA test
```

The results are the same as using the `lm` and `anova` function, but these results are needed for the post-hoc test. Now that we've obtained `res.aov1`, we will use peform the Tukey HSD test.


```{r}
library(agricolae)
res.t1 <- HSD.test(res.aov1, trt = "Habit")
# The `trt = "Habit"` argument is used to define the constant of the model (which in this case is the type of habit)
res.t1
```

The Tukey HSD test gives us a lot of results, and out of these we will use the `$groups` part to understand the difference between means.

```{r}
res.t1$groups
```

These results give us two things, the mean value of the score, and the groups that the scores belong to. If two scores share the same alphabet letter, they are not significantly different, but if they do not, they are significantly different. For example, `vegetarian_score` and `car_alone_score` share the alphabet letter `a` and this means that they are not significantly different. But, `vegetarian_score` and `local_products_score` do not share any alphabet letters, meaning that they are significantly different.

[**Now it's your turn!**]{style="color:red"}

Run the next line of the script.

```{r}
res2 <- lm(Score ~ situation, data_long_score)
anova(res2)
```

The variable `situation` is the financial situation of the participant./
* What is the research question we are trying to answer with this model?
* Does the variable `situation` have a significant influence on the score?
* Should we conduct a post-hoc test on the variable `situation`?

```{r}
res.aov2 <- aov(Score ~ situation, data_long_score)
res.t2 <- HSD.test(res.aov2, trt = "situation")
res.t2$groups
```

* Which group is the H group significantly different from? How about the M group?
* Which groups can we conclude are significantly different from each other?

## Vocabulary of this session

### R commands

-   library

### R environment

-   packages

### Statistical terms

-   Counting frequencies
-   Calculating the mean value
